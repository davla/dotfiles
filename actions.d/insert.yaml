actions:
  pre:
    strip_range: >
      sed -i -E '/{0}/,/{1}/ {{
          /{0}/n
          /{1}/ ! {{
            d
          }}
        }}' {2}
    strip_xml: >-
      python -c "
        import xml.etree.ElementTree as ET

        with open('{1}', 'r') as f:
            document = ET.parse(f)

        parent = document.find("{0}/..")
        target = parent.find("{0}")
        parent.remove(target)
        document.write('{1}', encoding='UTF-8', xml_declaration=True)"
  post:
    insert_match: "sed -i -E '/{0}/ r {1}' {2}"
    insert_xml: >-
      python -c "
        import xml.etree.ElementTree as ET

        with open('{1}', 'r') as source, open('{2}', 'r') as dest:
            source_document = ET.parse(source)
            dest_document = ET.parse(dest)

        node = source_document.find('.')
        parent = dest_document.find("{0}/..")
        target = parent.find("{0}")

        index = next(
            index
            for index, child in enumerate(parent)
            if child == target
        )
        parent.insert(index + 1, node)
        document.write('{2}', encoding='UTF-8', xml_declaration=True)"
    rm: rm -f {0}
