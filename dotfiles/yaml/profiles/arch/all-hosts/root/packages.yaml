%YAML 1.2
---
# This dotdrop config file defines the packages profile for Arch. It mostly
# consists of pacman hooks.

config:
  backup: false
  banner: true
  create: true
  dotpath: ../../../../../dotfiles
  func_file:
  - ../../../../../python/functions.py
  ignoreempty: true
  import_actions:
  - ../../../../actions/append.yaml
  - ../../../../actions/insert.yaml
  keepdot: false
  link_dotfile_default: nolink
  link_on_import: nolink
  longkey: false
  showdiff: true
  workdir: '{{@@ xdg_config("dotdrop") @@}}'

dotfiles:
  d_pacman_hooks:
    src: etc/pacman.d/hooks
    dst: /etc/pacman.d/hooks
    # These ignore fields are necessary because some hooks are host-specific
    cmpignore:
    - '*/i3blocks-contrib*.hook'
    instignore:
    - '*/i3blocks-contrib*.hook'
    upignore:
    - '*/i3blocks-contrib*.hook'
  f_pacman_conf:
    src: etc/pacman.conf
    # Dynamic path since the dotfile content is appended to dst
    dst: '{{@@ pacman_tmp_dst @@}}'
    actions:
    - _strip '{{@@ pacman_conf_append_marker @@}}' '{{@@ pacman_conf_dst @@}}'
    - _append '{{@@ pacman_conf_dst @@}}' '{{@@ pacman_tmp_dst @@}}'
  f_pacman_ignore:
    src: etc/pacman.d/ignore
    # Dynamic path as it's used somewhere else too
    dst: '{{@@ pacman_ignore_path @@}}'
  f_pacman_hooks.bin_nordvpn-setup:
    src: usr/local/share/pacman/hooks.bin/nordvpn-setup
    # Dynamic path as it's used somewhere else too
    dst: '{{@@ nordvpn_setup_path @@}}'
  f_pacman_mirrorlists:
    src: etc/pacman.d/mirrorlists
    # Dynamic path as it's used somewhere else too
    dst: '{{@@ pacman_mirrorlists_path @@}}'
  f_pacman_options:
    src: etc/pacman.d/options
    # Dynamic path as it's used somewhere else too
    dst: '{{@@ pacman_options_path @@}}'

profiles:
  # This profile contains pacman hooks
  packages:
    dotfiles:
    - d_pacman_hooks
    - f_pacman_conf
    - f_pacman_ignore
    - f_pacman_hooks.bin_nordvpn-setup
    - f_pacman_mirrorlists
    - f_pacman_options
    dynvariables:
      pacman_tmp_dst: mktemp /tmp/pacman-append.XXX
    variables:
      nordvpn_setup_path: /usr/local/share/pacman/hooks.bin/nordvpn-setup
      pacman_conf_append_marker: Custom configuration
      pacman_conf_dst: /etc/pacman.conf
      pacman_ignore_path: /etc/pacman.d/ignore
      pacman_mirrorlists_path: /etc/pacman.d/mirrorlists
      pacman_options_path: /etc/pacman.d/options
